name: Build Hugo Site

on:
  push:
    branches: [ main ]
  repository_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. Website-Repo (f√ºr Workflow + Deployment)
      - name: Checkout website repo
        uses: actions/checkout@v3

      # 2. Content-Repo klonen
      - name: Checkout content repo
        uses: actions/checkout@v3
        with:
          repository: jasokann/lek-nrw-content
          path: site

      # 3. Theme ins Content-Repo klonen
      - name: Checkout theme repo
        uses: actions/checkout@v3
        with:
          repository: jasokann/lek-nrw-theme
          path: theme-temp

      # 4. Theme in das richtige Verzeichnis verschieben
      - name: Move theme into content repo
        run: |
          mkdir -p site/themes
          rm -rf site/themes/lek-nrw-theme
          mv theme-temp site/themes/lek-nrw-theme

      # 5. Hugo installieren
      - name: Install Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: "0.121.1"
          extended: true

      # 6. Hugo im Content-Repo bauen
      - name: Build Hugo
        run: |
          cd site
          hugo --minify

      # 7. Deployment (GitHub Pages)
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./site/public
